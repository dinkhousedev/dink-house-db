_format_version: "2.1"
_transform: true

services:
  - name: auth-v1
    url: http://postgres:5432/
    routes:
      - name: auth-v1-all
        strip_path: true
        paths:
          - /auth/v1/

  - name: rest-v1
    url: http://postgres:5432/
    routes:
      - name: rest-v1-all
        strip_path: true
        paths:
          - /rest/v1/

  - name: realtime-v1
    url: http://postgres:5432/
    routes:
      - name: realtime-v1-all
        strip_path: true
        paths:
          - /realtime/v1/

  - name: storage-v1
    url: http://postgres:5432/
    routes:
      - name: storage-v1-all
        strip_path: true
        paths:
          - /storage/v1/

  - name: pg-meta
    url: http://pg-meta:8080/
    routes:
      - name: pg-meta-all
        strip_path: true
        paths:
          - /pg/

plugins:
  - name: cors
    config:
      origins:
        - http://localhost:3000
        - http://localhost:9000
        - http://localhost:9002
      credentials: true
      exposed_headers:
        - X-Auth-Token
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - X-Auth-Token
        - X-Client-Info
        - Apikey
        - Authorization
      max_age: 86400
      methods:
        - GET
        - HEAD
        - PUT
        - PATCH
        - POST
        - DELETE
        - OPTIONS

  - name: request-transformer
    config:
      add:
        headers:
          - x-forwarded-prefix:/

  - name: key-auth
    config:
      key_names:
        - apikey
      key_in_body: false
      key_in_header: true
      key_in_query: true
      hide_credentials: true
      anonymous: 3b9c0ff0-807a-4da5-b8e5-9b7a4f9c3d5e

consumers:
  - username: anon
    id: 3b9c0ff0-807a-4da5-b8e5-9b7a4f9c3d5e
    keyauth_credentials:
      - key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzU4ODM4OTY0LCJleHAiOjIwNzQxOTg5NjR9.CKoGIoMTUDl6x8kmtaIuAMjGBvlV_7KyJhC-DSb-akI

  - username: service_role
    id: 5c6c0ff0-907b-5eb6-c9f6-0c8b5f0d4e6f
    keyauth_credentials:
      - key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoic2VydmljZV9yb2xlIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NTg4Mzg5NjQsImV4cCI6MjA3NDE5ODk2NH0.8H_56dyR3AUPJi44Jgf5O7iuKg12FHmrkZWfLU6zoc0